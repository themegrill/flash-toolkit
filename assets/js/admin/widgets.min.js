jQuery(function(a){function b(a){var b=a.find(".tg-widget-repeater-field-items"),c=b.find("li.tg-widget-accordion-item"),d=wp.template("tg-widget-repeater-field-blank");c.length?(a.find(".tg-widget-repeater-field-button").show(),c.length<flashToolkitLocalizeScript.i18n_max_field_entries&&a.find(".tg-widget-repeater-field-button a").removeClass("disabled")):(a.find(".tg-widget-repeater-field-button").hide(),a.find(".tg-widget-repeater-field-blank-state").remove(),b.append(d))}function c(b){b.find(".tg-widget-repeater-field-items").sortable({items:"> li",handle:"> .accordion-top > .accordion-title",cursor:"move",axis:"y",distance:2,opacity:.65,scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,placeholder:"tg-widget-sortable-placeholder",start:function(b,c){var d=c.item.children(".accordion-inside");"block"===d.css("display")&&(c.item.removeClass("open"),d.hide(),a(this).sortable("refreshPositions"))},stop:function(a,b){b.item.removeAttr("style")}})}var d;a(document.body).on("click",".tg-image-upload",function(b){var c=a(this),e=c.parent().find(".tg-media-input"),f=c.parent().parent().find(".tg-media-preview");b.preventDefault(),d=wp.media.frames.media_file=wp.media({title:c.data("choose"),button:{text:c.data("update")},states:[new wp.media.controller.Library({title:c.data("choose"),library:wp.media.query({type:"image"})})]}),d.on("select",function(){var a=d.state().get("selection").first().toJSON();e.val(a.url),f.css({display:"none"}).find("img").remove(),f.css({display:"block"}).append('<img src="'+a.url+'">')}),d.open()}),a(document.body).on("click",".tg-media-remove",function(){var b=a(this).closest(".media-uploader");return b.find(".tg-media-input").val(""),b.find(".tg-media-preview").css({display:"none"}).find("img").remove(),!1}),a(document.body).on("flash-toolkit-init-media-preview",function(){a("input.tg-media-input").each(function(){var b=a(this).val(),c=a(this).parent().siblings(".tg-media-preview");""!==b&&(c.find("img.tg-media-preview-default").remove(),c.css({display:"block"}).append('<img src="'+b+'">'))})}).trigger("flash-toolkit-init-media-preview"),a(document.body).on("flash-toolkit-init-availability",function(){a("select.icon_chooser").change(function(){"image"===a(this).val()?(a(this).closest("p").next(".show_if_icon").hide(),a(this).closest("p").next().next(".show_if_image").show()):(a(this).closest("p").next(".show_if_icon").show(),a(this).closest("p").next().next(".show_if_image").hide())}).change(),a("input.availability").change(function(){a(this).is(":checked")?a(this).closest("p").next("p").hide():a(this).closest("p").next("p").show()}).change()}).trigger("flash-toolkit-init-availability"),a(document.body).on("flash-toolkit-init-accordion-title",function(){a(".tg-widget-repeater-field-items").children("li").each(function(){var b=a('input[id*="-title"]',this).val()||"";b&&(b=": "+b.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;")),a(this).children(".accordion-top").children(".accordion-title").children().children(".in-accordion-title").html(b)})}).trigger("flash-toolkit-init-accordion-title"),a(document.body).on("click",".tg-widget-repeater-field-add",function(b){if(b.preventDefault(),a(this).is(".disabled"))return void window.alert(flashToolkitLocalizeScript.i18n_max_field_message);var c=a(this).parents(".widget-content"),d=c.find("li.tg-widget-accordion-item").length+1,e=c.find(".tg-widget-repeater-field-items").data("widget_id"),f=wp.template("tg-widget-repeater-field-"+e);c.find("li.tg-widget-accordion-item").each(function(b,c){d===parseInt(a(c).data("id").replace(/[^0-9\.]/g,""),10)&&d++}),c.find(".tg-widget-repeater-field-button").show(),c.find(".tg-widget-repeater-field-blank-state").remove(),c.find(".tg-widget-repeater-field-items").append(f({field_id:d})),d>=flashToolkitLocalizeScript.i18n_max_field_entries&&c.find(".tg-widget-repeater-field-button a").addClass("disabled")}),a(document.body).on("click.accordion-toggle",function(c){var d,e,f,g=a(c.target);g.parents(".accordion-top").length&&!g.parents("#available-fields").length?(d=g.closest("li.tg-widget-accordion-item"),e=d.children(".accordion-inside"),e.is(":hidden")?(d.addClass("open"),e.slideDown("fast")):e.slideUp("fast",function(){d.attr("style",""),d.removeClass("open")}),c.preventDefault()):g.hasClass("accordion-control-close")?(d=g.closest("li.tg-widget-accordion-item"),d.children(".accordion-inside").slideUp("fast",function(){d.attr("style",""),d.removeClass("open")}),c.preventDefault()):g.hasClass("accordion-control-remove")&&(d=g.closest("li.tg-widget-accordion-item"),f=g.parents(".widget[id*=themegrill_flash], .widget-content"),d.remove(),b(f),c.preventDefault())}),a(document.body).on("panelsopen",function(d){var e=a(d.target);return!!e.has(".tg-widget-repeater-field-items")&&(e.addClass("widget-content"),b(e),c(e),a(document.body).trigger("flash-enhanced-select-init"),a(document.body).trigger("flash-toolkit-init-availability"),a(document.body).trigger("flash-toolkit-init-media-preview"),void a(document.body).trigger("flash-toolkit-init-accordion-title"))}),a(document.body).on("click",".so-close",function(){a(document.body).trigger("flash-toolkit-init-accordion-title")}),a(document.body).on("click","div.widget[id*=themegrill_flash] .widget-title, div.widget[id*=themegrill_flash] .widget-title-action",function(){a(this).parents("#available-widgets").length||(b(a(this).parents(".widget[id*=themegrill_flash]")),c(a(this).parents(".widget[id*=themegrill_flash]")))}),a(document).on("widget-added widget-updated",function(d,e){e.is("[id*=themegrill_flash]")&&(d.preventDefault(),b(e),c(e),a(document.body).trigger("flash-enhanced-select-init"),a(document.body).trigger("flash-toolkit-init-availability"),a(document.body).trigger("flash-toolkit-init-media-preview"),a(document.body).trigger("flash-toolkit-init-accordion-title"))})});